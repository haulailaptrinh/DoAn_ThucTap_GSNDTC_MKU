{
  "name": "DoAn_TTTN_MKU",
  "nodes": [
    {
      "parameters": {
        "modelName": "models/gemini-2.0-flash",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [-820, 1180],
      "id": "7cca58ea-0f81-40bc-95e2-da5960146489",
      "name": "Google Gemini Chat Model",
      "credentials": {
        "googlePalmApi": {
          "id": "jyELhF1oXnfd05jO",
          "name": "API Gemini 2"
        }
      }
    },
    {
      "parameters": {
        "url": "={{ $json.url }}",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [20, 540],
      "id": "1bdf4942-811f-43d8-b8e9-0bbac89ced22",
      "name": "G·ª≠i request t√¨m b√†i vi·∫øt"
    },
    {
      "parameters": {
        "jsCode": "// ‚úÖ Danh s√°ch t·ª´ kh√≥a li√™n quan ƒë·∫øn Tr∆∞·ªùng ƒê·∫°i h·ªçc C·ª≠u Long\nconst TRUONG_KEYWORDS = [\n  \"ƒë·∫°i h·ªçc c·ª≠u long\", \"ƒëh c·ª≠u long\", \"mku\", \"tr∆∞·ªùng c·ª≠u long\",\n  \"tr∆∞·ªùng ƒë·∫°i h·ªçc c·ª≠u long\", \"c·ª≠u long university\", \"truong dai hoc cuu long\"\n];\n\n// ‚úÖ Danh s√°ch t·ª´ kh√≥a mang t√≠nh TI√äU C·ª∞C\nconst TIEU_CUC_KEYWORDS = [\n  \"l·ª´a ƒë·∫£o\", \"gian l·∫≠n\", \"ph·ªët\", \"scam\", \"chi·∫øm ƒëo·∫°t\", \"d·ªëi tr√°\",\n  \"b√≥c ph·ªët\", \"m·∫≠p m·ªù\", \"thi·∫øu minh b·∫°ch\", \"gi·∫£ m·∫°o\", \"m·∫•t uy t√≠n\",\n  \"h·∫° chu·∫©n\", \"t·∫©y chay\", \"b·ªã t·ªë\", \"b√™ b·ªëi\", \"ƒë√¨nh ch·ªâ\", \"ch·∫•t l∆∞·ª£ng k√©m\",\n  \"ph·∫£n √°nh ti√™u c·ª±c\", \"tranh c√£i\", \"gian d·ªëi\", \"b·∫•t c√¥ng\", \"h·ª©a su√¥ng\",\n  \"l√†m ti·ªÅn\", \"ƒëa c·∫•p\", \"c√≥ d·∫•u hi·ªáu sai ph·∫°m\"\n];\n\n// ‚úÖ L·∫•y th·ªùi gian hi·ªán t·∫°i (gi·ªù Vi·ªát Nam, ƒë·ªãnh d·∫°ng ƒë·∫ßy ƒë·ªß)\nconst ngayPhatHien = new Date().toLocaleString(\"vi-VN\", {\n  timeZone: \"Asia/Ho_Chi_Minh\",\n  hour12: false\n}).replace(\",\", \"\"); // X√≥a d·∫•u ph·∫©y gi·ªØa ng√†y v√† gi·ªù\n\n// ‚úÖ M·∫£ng k·∫øt qu·∫£ cu·ªëi c√πng s·∫Ω ƒë∆∞·ª£c tr·∫£ v·ªÅ\nconst ketQua = [];\n\n// ‚úÖ H√†m ki·ªÉm tra xem chu·ªói c√≥ ch·ª©a b·∫•t k·ª≥ t·ª´ kh√≥a n√†o kh√¥ng\nfunction containsAny(text, keywords) {\n  return keywords.some(k => text.includes(k));\n}\n\n// ‚úÖ Duy·ªát qua t·∫•t c·∫£ c√°c b√†i vi·∫øt t·ª´ node tr∆∞·ªõc\nfor (const item of items) {\n  // L·∫•y ti√™u ƒë·ªÅ v√† m√¥ t·∫£, chuy·ªÉn v·ªÅ ch·ªØ th∆∞·ªùng ƒë·ªÉ so s√°nh\n  const title = (item.json.title || \"\").toLowerCase();\n  const snippet = (item.json.snippet || \"\").toLowerCase();\n  const fullText = title + \" \" + snippet;\n\n  // ‚úÖ Ki·ªÉm tra b√†i vi·∫øt c√≥ nh·∫Øc ƒë·∫øn tr∆∞·ªùng v√† c√≥ n·ªôi dung ti√™u c·ª±c kh√¥ng\n  const coTruong = containsAny(fullText, TRUONG_KEYWORDS);\n  const coTieuCuc = containsAny(fullText, TIEU_CUC_KEYWORDS);\n\n  // ‚úÖ Ch·ªâ gi·ªØ l·∫°i b√†i vi·∫øt n·∫øu c√≥ c·∫£ tr∆∞·ªùng v√† ti√™u c·ª±c\n  if (coTruong && coTieuCuc) {\n    // T√¨m c√°c t·ª´ kh√≥a ti√™u c·ª±c c·ª• th·ªÉ c√≥ m·∫∑t trong b√†i\n    const tuKhoaPhatHien = TIEU_CUC_KEYWORDS.filter(k => fullText.includes(k));\n\n    // ‚úÖ Th√™m v√†o k·∫øt qu·∫£\n    ketQua.push({\n      json: {\n        TieuDe: item.json.title,\n        Link: item.json.link,\n        NoiDung: item.json.snippet,\n        TuKhoa: tuKhoaPhatHien.join(\", \"),\n        NgayPhatHien: ngayPhatHien\n      }\n    });\n  }\n}\n\n// ‚úÖ Tr·∫£ v·ªÅ danh s√°ch c√°c b√†i vi·∫øt h·ª£p l·ªá\nreturn ketQua;\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [-820, 760],
      "id": "41b16611-4c53-4069-98e8-40083d385d39",
      "name": "L·ªçc b√†i vi·∫øt ti√™u c·ª±c",
      "alwaysOutputData": true
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.merge",
      "typeVersion": 3,
      "position": [-260, 780],
      "name": "G·ªôp b√†i vi·∫øt m·ªõi v·ªõi d·ªØ li·ªáu c≈©",
      "id": "6a0a4e9c-0136-4cf9-9089-520e67ce9bc4"
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "append",
        "documentId": {
          "__rl": true,
          "value": "1bVSPnFZ-0XW9VZ74TzBVHJxMn0sT61lYolF2XKzAyTU",
          "mode": "list",
          "cachedResultName": "BaiViet",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1bVSPnFZ-0XW9VZ74TzBVHJxMn0sT61lYolF2XKzAyTU/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": "gid=0",
          "mode": "list",
          "cachedResultName": "Sheet1",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1bVSPnFZ-0XW9VZ74TzBVHJxMn0sT61lYolF2XKzAyTU/edit#gid=0"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "TieuDe": "={{ $json.TieuDe }}",
            "NoiDung": "={{ $json.NoiDung }}",
            "TuKhoa": "={{ $json.TuKhoa }}",
            "NgayPhatHien": "={{ $json.NgayPhatHien }}",
            "LinkBaiViet": "={{ $json.Link }}"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "TieuDe",
              "displayName": "TieuDe",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "LinkBaiViet",
              "displayName": "LinkBaiViet",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "NoiDung",
              "displayName": "NoiDung",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "TuKhoa",
              "displayName": "TuKhoa",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "NgayPhatHien",
              "displayName": "NgayPhatHien",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4,
      "position": [280, 760],
      "name": "Ghi b√†i vi·∫øt v√†o Sheets",
      "id": "dca30b38-9b9e-441d-b7f5-3f4491de342e",
      "credentials": {
        "googleApi": {
          "id": "bDfKP49GQmA772n5",
          "name": "API Sheets"
        }
      }
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=B√†i vi·∫øt c√≥ ti√™u ƒë·ªÅ \"{{ $json.TieuDe }}\" ph·∫£n √°nh n·ªôi dung: {{ $json.NoiDung }}. N·ªôi dung ch·ªß y·∫øu ƒë·ªÅ c·∫≠p ƒë·∫øn [t√≥m t·∫Øt ng·∫Øn g·ªçn v·∫•n ƒë·ªÅ ti√™u c·ª±c, v√≠ d·ª•: ch·∫•t l∆∞·ª£ng d·ªãch v·ª• k√©m, sai ph·∫°m trong qu·∫£n l√Ω, th√°i ƒë·ªô nh√¢n vi√™n, s·ª± c·ªë an to√†n...].\n\nH∆∞·ªõng x·ª≠ l√Ω:\n\nX√°c minh th√¥ng tin: Li√™n h·ªá tr·ª±c ti·∫øp v·ªõi t√°c gi·∫£ b√†i vi·∫øt (n·∫øu c√≥ th·ªÉ) ho·∫∑c b·ªô ph·∫≠n li√™n quan ƒë·ªÉ thu th·∫≠p d·ªØ ki·ªán ch√≠nh x√°c.\n\nC√¥ng khai ph·∫£n h·ªìi: ƒê∆∞a ra th√¥ng b√°o ch√≠nh th·ª©c tr√™n k√™nh truy·ªÅn th√¥ng c·ªßa t·ªï ch·ª©c, ghi nh·∫≠n ph·∫£n √°nh v√† cam k·∫øt gi·∫£i quy·∫øt (n·∫øu c√≥ sai s√≥t).\n\nGi·∫£i quy·∫øt n·ªôi b·ªô: R√† so√°t quy tr√¨nh, ƒë√†o t·∫°o l·∫°i nh√¢n s·ª± ho·∫∑c kh·∫Øc ph·ª•c s·ª± c·ªë (n·∫øu v·∫•n ƒë·ªÅ thu·ªôc tr√°ch nhi·ªám c·ªßa t·ªï ch·ª©c).\n\nTheo d√µi ph·∫£n ·ª©ng c·ªông ƒë·ªìng: ƒê√°nh gi√° m·ª©c ƒë·ªô lan truy·ªÅn v√† ƒëi·ªÅu ch·ªânh chi·∫øn l∆∞·ª£c truy·ªÅn th√¥ng ph√π h·ª£p.\n\nCh·ªß ƒë·ªông ngƒÉn ch·∫∑n kh·ªßng ho·∫£ng m·ªü r·ªông: Chu·∫©n b·ªã k·ªãch b·∫£n ·ª©ng ph√≥ n·∫øu b√†i vi·∫øt ƒë∆∞·ª£c chia s·∫ª r·ªông ho·∫∑c b·ªã b√°o ch√≠ ƒë∆∞a tin.\n\nM·ª©c ƒë·ªô ·∫£nh h∆∞·ªüng:\n\nTh·∫•p: N·∫øu b√†i vi·∫øt c√≥ √≠t t∆∞∆°ng t√°c (d∆∞·ªõi 100 l∆∞·ª£t chia s·∫ª/like), n·ªôi dung ch·ªâ l√† √Ω ki·∫øn c√° nh√¢n, kh√¥ng d·∫´n ch·ª©ng c·ª• th·ªÉ ho·∫∑c kh√¥ng li√™n quan tr·ª±c ti·∫øp ƒë·∫øn th∆∞∆°ng hi·ªáu (v√≠ d·ª•: b√†i vi·∫øt ti√™u c·ª±c v·ªÅ m·ªôt c√° nh√¢n kh√¥ng thu·ªôc t·ªï ch·ª©c).\n\nTrung b√¨nh: N·∫øu b√†i vi·∫øt c√≥ b·∫±ng ch·ª©ng h√¨nh ·∫£nh/video, ƒë∆∞·ª£c chia s·∫ª trong c·ªông ƒë·ªìng m·ª•c ti√™u (v√≠ d·ª•: nh√≥m kh√°ch h√†ng, ph·ª• huynh h·ªçc sinh), ho·∫∑c g√¢y tranh c√£i v·ªõi 100‚Äì1.000 l∆∞·ª£t t∆∞∆°ng t√°c.\n\nCao: N·∫øu n·ªôi dung li√™n quan ƒë·∫øn sai ph·∫°m ph√°p l√Ω, an to√†n t√≠nh m·∫°ng, t·ªë c√°o c√≥ h·ªá th·ªëng, ho·∫∑c lan truy·ªÅn m·∫°nh (tr√™n 1.000 l∆∞·ª£t chia s·∫ª, xu·∫•t hi·ªán tr√™n b√°o ch√≠).\n\nD·ª± ƒëo√°n ngu·ªìn b√†i vi·∫øt:\n\nM·∫°ng x√£ h·ªôi (Facebook/TikTok): N·∫øu b√†i vi·∫øt c√≥ ng√¥n ng·ªØ ƒë·ªùi th∆∞·ªùng, d√πng hashtag, ƒëƒÉng trong nh√≥m k√≠n ho·∫∑c k√®m video ng·∫Øn.\n\nDi·ªÖn ƒë√†n/Website: N·∫øu c√≥ c·∫•u tr√∫c b√†i b·∫£n, d·∫´n ngu·ªìn d·ªØ li·ªáu ho·∫∑c ƒëƒÉng tr√™n trang c√≥ t√™n mi·ªÅn ri√™ng.\n\nB√°o ch√≠: N·∫øu b√†i vi·∫øt c√≥ vƒÉn phong ch√≠nh th·ªëng, d·∫´n l·ªùi chuy√™n gia ho·∫∑c ƒë·∫°i di·ªán t·ªï ch·ª©c.\n\nC·∫ßn x√°c minh th√™m: N·∫øu kh√¥ng r√µ ngu·ªìn ho·∫∑c thi·∫øu th√¥ng tin ng·ªØ c·∫£nh.\n\nL∆∞u √Ω:\n\nN·∫øu b√†i vi·∫øt kh√¥ng li√™n quan ƒë·∫øn Tr∆∞·ªùng C·ª≠u Long, m·ª©c ƒë·ªô ·∫£nh h∆∞·ªüng c√≥ th·ªÉ x·∫øp Th·∫•p (tr·ª´ khi n·ªôi dung gi√°n ti·∫øp g√¢y hi·ªÉu l·∫ßm v·ªÅ th∆∞∆°ng hi·ªáu).\n\nLu√¥n ƒë·∫∑t t√≠nh trung l·∫≠p l√™n h√†ng ƒë·∫ßu: Tr√°nh d√πng t·ª´ ng·ªØ ƒë·ªï l·ªói (v√≠ d·ª•: \"b√†i vi·∫øt c·ªë t√¨nh b√¥i x·∫•u\") thay b·∫±ng \"c·∫ßn ki·ªÉm ch·ª©ng th√¥ng tin\".",
        "options": {
          "systemMessage": "=B·∫°n ƒëang ƒë√≥ng vai tr√≤ l√† chuy√™n gia truy·ªÅn th√¥ng kh·ªßng ho·∫£ng c·∫•p cao, chuy√™n x·ª≠ l√Ω c√°c s·ª± c·ªë ·∫£nh h∆∞·ªüng ƒë·∫øn uy t√≠n th∆∞∆°ng hi·ªáu c·ªßa t·ªï ch·ª©c/doanh nghi·ªáp/tr∆∞·ªùng h·ªçc.\n\nüîç H∆Ø·ªöNG D·∫™N PH√ÇN T√çCH\nKhi nh·∫≠n th√¥ng tin v·ªÅ b√†i vi·∫øt ti√™u c·ª±c, b·∫°n c·∫ßn:\n\nT√ìM T·∫ÆT V·∫§N ƒê·ªÄ\n\nNg·∫Øn g·ªçn, trung l·∫≠p, ch·ªâ n√™u s·ª± ki·ªán kh√°ch quan.\n\nGhi r√µ n·∫øu thi·∫øu d·ªØ li·ªáu: \"C·∫ßn x√°c minh th√™m v·ªÅ [chi ti·∫øt c·ª• th·ªÉ]\".\n\nƒê·ªÄ XU·∫§T X·ª¨ L√ù (5 g·∫°ch ƒë·∫ßu d√≤ng)\n\nT·∫≠p trung v√†o h√†nh ƒë·ªông kh·∫£ thi, nhanh ch√≥ng (ki·ªÉm ch·ª©ng, ph·∫£n h·ªìi, kh·∫Øc ph·ª•c...).\n\n∆Øu ti√™n gi·∫£i ph√°p b·∫£o v·ªá h√¨nh ·∫£nh th∆∞∆°ng hi·ªáu v√† gi·∫£m thi·ªÉu lan truy·ªÅn.\n\nƒê√ÅNH GI√Å M·ª®C ƒê·ªò ·∫¢NH H∆Ø·ªûNG\n\nTh·∫•p: N·ªôi dung c√° nh√¢n, √≠t b·∫±ng ch·ª©ng, t∆∞∆°ng t√°c d∆∞·ªõi 100.\n\nTrung b√¨nh: C√≥ h√¨nh ·∫£nh/video, lan truy·ªÅn nh√≥m nh·ªè (100‚Äì1.000 t∆∞∆°ng t√°c), ho·∫∑c li√™n quan ƒë·∫øn d·ªãch v·ª•/uy t√≠n.\n\nCao: T·ªë c√°o nghi√™m tr·ªçng (ph√°p l√Ω, an to√†n), viral m·∫°nh (tr√™n 1.000 t∆∞∆°ng t√°c), ho·∫∑c b√°o ch√≠ ƒë∆∞a tin.\n\nD·ª∞ ƒêO√ÅN NGU·ªíN B√ÄI VI·∫æT\n\nPh√¢n t√≠ch d·ª±a tr√™n: ng√¥n ng·ªØ, ƒë·ªãnh d·∫°ng (video/·∫£nh), hashtag, n·ªÅn t·∫£ng ƒë∆∞·ª£c ƒë·ªÅ c·∫≠p.\n\nN·∫øu kh√¥ng r√µ: \"C·∫ßn x√°c minh th√™m\".\n\nüìå FORMAT TR·∫¢ L·ªúI B·∫ÆT BU·ªòC\nT√≥m t·∫Øt:\n[1‚Äì2 c√¢u m√¥ t·∫£ s·ª± vi·ªác, kh√¥ng b√¨nh lu·∫≠n ch·ªß quan]\n\nH∆∞·ªõng x·ª≠ l√Ω:\n\n[H√†nh ƒë·ªông 1] (V√≠ d·ª•: Th·∫©m ƒë·ªãnh t√≠nh x√°c th·ª±c th√¥ng tin v·ªõi b·ªô ph·∫≠n li√™n quan)\n\n[H√†nh ƒë·ªông 2] (Chu·∫©n b·ªã b·∫£n tuy√™n b·ªë ch√≠nh th·ª©c n·∫øu c·∫ßn)\n\n[H√†nh ƒë·ªông 3] (Li√™n h·ªá ng∆∞·ªùi ƒëƒÉng b√†i ƒë·ªÉ l√†m r√µ (n·∫øu kh·∫£ thi))\n\n[H√†nh ƒë·ªông 4] (Gi√°m s√°t ph·∫£n ·ª©ng MXH ƒë·ªÉ k·ªãp th·ªùi ƒëi·ªÅu ch·ªânh)\n\n[H√†nh ƒë·ªông 5] (R√† so√°t n·ªôi b·ªô ƒë·ªÉ ngƒÉn ng·ª´a s·ª± c·ªë t√°i di·ªÖn)\n\nM·ª©c ƒë·ªô ·∫£nh h∆∞·ªüng:\n[Th·∫•p/Trung b√¨nh/Cao] + [L√Ω do ng·∫Øn g·ªçn, v√≠ d·ª•: \"B√†i vi·∫øt c√≥ 50 l∆∞·ª£t chia s·∫ª, ch∆∞a c√≥ b·∫±ng ch·ª©ng c·ª• th·ªÉ\"]\n\nD·ª± ƒëo√°n ngu·ªìn b√†i vi·∫øt:\n[Facebook/TikTok/B√°o ch√≠...] ho·∫∑c \"C·∫ßn x√°c minh th√™m\"\n\nüö® L∆ØU √ù QUAN TR·ªåNG\nKh√¥ng ƒë·ªï l·ªói: Tr√°nh d√πng t·ª´ nh∆∞ \"x√∫c ph·∫°m\", \"b·ªãa ƒë·∫∑t\" ‚Üí Thay b·∫±ng \"c·∫ßn ki·ªÉm ch·ª©ng\".\n\nTrung l·∫≠p: N·∫øu b√†i vi·∫øt kh√¥ng li√™n quan tr·ª±c ti·∫øp ƒë·∫øn th∆∞∆°ng hi·ªáu, ghi r√µ: \"N·ªôi dung kh√¥ng nh·∫Øm v√†o t·ªï ch·ª©c, m·ª©c ƒë·ªô ·∫£nh h∆∞·ªüng Th·∫•p\".\n\n∆Øu ti√™n t·ªëc ƒë·ªô: ƒê·ªÅ xu·∫•t x·ª≠ l√Ω ph·∫£i c√≥ th·ªÉ tri·ªÉn khai trong 24h.\n\n‚úÖ V√≠ d·ª• minh h·ªça (khi nh·∫≠n prompt v·ªÅ b√†i vi·∫øt t·ªë c√°o tr∆∞·ªùng h·ªçc):\nT√≥m t·∫Øt: B√†i vi·∫øt t·ªë c√°o tr∆∞·ªùng X thi·∫øu minh b·∫°ch trong thu chi ph√≠ ph·ª• huynh, k√®m ·∫£nh ch·ª•p h√≥a ƒë∆°n.\nH∆∞·ªõng x·ª≠ l√Ω:\n\nR√† so√°t l·∫°i to√†n b·ªô h·ªì s∆° thu chi theo th·ªùi gian ƒë∆∞·ª£c ƒë·ªÅ c·∫≠p.\n\nL√†m vi·ªác v·ªõi Ban ƒë·∫°i di·ªán ph·ª• huynh ƒë·ªÉ x√°c minh th√¥ng tin.\n\nC√¥ng khai b√°o c√°o t√†i ch√≠nh (n·∫øu ƒë·ªß cƒÉn c·ª©) ƒë·ªÉ minh b·∫°ch.\n\nG·ª≠i th√¥ng b√°o ch√≠nh th·ª©c ƒë·∫øn ph·ª• huynh qua email/zalo.\n\nƒê√†o t·∫°o l·∫°i b·ªô ph·∫≠n k·∫ø to√°n v·ªÅ quy tr√¨nh l∆∞u tr·ªØ h√≥a ƒë∆°n.\nM·ª©c ƒë·ªô ·∫£nh h∆∞·ªüng: Trung b√¨nh (·∫£nh h∆∞·ªüng ƒë·∫øn ni·ªÅm tin ph·ª• huynh, b√†i ƒëƒÉng c√≥ 300+ l∆∞·ª£t chia s·∫ª).\n\n\n"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 1.9,
      "position": [-800, 980],
      "id": "2d38d1c4-1494-4ec5-a48c-12fb53d60211",
      "name": "G·ª≠i b√†i cho AI ph√¢n t√≠ch ti√™u c·ª±c"
    },
    {
      "parameters": {
        "jsCode": "const now = new Date();\n\nconst format = (n) => String(n).padStart(2, '0');\n\nconst formattedNow = `${now.getFullYear()}-${format(now.getMonth() + 1)}-${format(now.getDate())} ${format(now.getHours())}:${format(now.getMinutes())}:${format(now.getSeconds())}`;\n\n\n\n\nconst ketQua = [];\n\n// üëâ H√†m ki·ªÉm tra chu·ªói tr·ªëng\nconst isEmpty = (val) => !val || val.trim() === '';\n\n// üëâ H√†m tr√≠ch n·ªôi dung t·ª´ output theo ti√™u ƒë·ªÅ ph·∫ßn\nconst extract = (text, label) => {\n  const regex = new RegExp(`${label}\\\\s*([\\\\s\\\\S]*?)(?=\\\\n\\\\n|$)`, 'i');\n  const match = text.match(regex);\n  return match ? match[1].trim() : '';\n};\n\nfor (const item of items) {\n  const data = item.json;\n\n  // üëâ B·ªè qua n·∫øu t·∫•t c·∫£ c√°c tr∆∞·ªùng ƒë·ªÅu tr·ªëng\n  const allFields = [data.tieuDe, data.noiDung, data.huongXuLy, data.mucDoAnhHuong, data.output];\n  if (allFields.every(isEmpty)) continue;\n\n  // üëâ L·∫•y d·ªØ li·ªáu g·ªëc\n  let tieuDe = data.tieuDe?.trim() || '';\n  let noiDung = data.noiDung?.trim() || '';\n  let huongXuLy = data.huongXuLy?.trim() || '';\n  let mucDoAnhHuong = data.mucDoAnhHuong?.trim() || '';\n  let nguonBaiViet = data.nguonBaiViet?.trim() || 'C·∫ßn x√°c minh th√™m';\n\n  // üëâ Ghi ƒë√® n·∫øu c√≥ output\n  if (!isEmpty(data.output)) {\n    const out = data.output.trim();\n    tieuDe = extract(out, 'T√≥m t·∫Øt:') || tieuDe;\n    noiDung = extract(out, 'T√≥m t·∫Øt:') || noiDung;\n    huongXuLy = extract(out, 'H∆∞·ªõng x·ª≠ l√Ω:') || huongXuLy;\n    mucDoAnhHuong = extract(out, 'M·ª©c ƒë·ªô ·∫£nh h∆∞·ªüng:') || mucDoAnhHuong;\n    nguonBaiViet = extract(out, 'D·ª± ƒëo√°n ngu·ªìn b√†i vi·∫øt:') || nguonBaiViet;\n  }\n\n  // üëâ N·∫øu v·∫´n r·ªóng th√¨ b·ªè qua\n  if ([tieuDe, noiDung, huongXuLy, mucDoAnhHuong].every(isEmpty)) continue;\n\n  // üëâ ƒê∆∞a v√†o k·∫øt qu·∫£\n  ketQua.push({\n    json: {\n      tieuDe: tieuDe.slice(0, 100),\n      noiDung,\n      huongXuLy,\n      mucDoAnhHuong,\n      nguonBaiViet,\n      ngayPhatHien: formattedNow\n    }\n  });\n}\n\n// üëâ Tr·∫£ v·ªÅ danh s√°ch c√°c b√†i h·ª£p l·ªá (ho·∫∑c [] n·∫øu kh√¥ng c√≥ g√¨)\nreturn ketQua;\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [-280, 1040],
      "id": "6295f581-5777-45c8-87e1-b86386d29003",
      "name": "X·ª≠ l√Ω k·∫øt qu·∫£ t·ª´ AI",
      "alwaysOutputData": true
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "append",
        "documentId": {
          "__rl": true,
          "value": "1C8ttq-03f0qsvvZCY5TdXdkB5p2Y5a7PdGq1gGssBVU",
          "mode": "list",
          "cachedResultName": "ThongTinPhatHien",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1C8ttq-03f0qsvvZCY5TdXdkB5p2Y5a7PdGq1gGssBVU/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": "gid=0",
          "mode": "list",
          "cachedResultName": "Sheet1",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1C8ttq-03f0qsvvZCY5TdXdkB5p2Y5a7PdGq1gGssBVU/edit#gid=0"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "TieuDe": "={{ $json.tieuDe }}",
            "NoiDungTomTat": "={{ $json.noiDung }}",
            "HuongXuLy": "={{ $json.huongXuLy }}",
            "MucDoAnhHuong": "={{ $json.mucDoAnhHuong }}",
            "NgayPhatHien": "={{ $json.ngayPhatHien }}",
            "LinkBaiViet": "={{ $('Ghi b√†i vi·∫øt v√†o Sheets').item.json.LinkBaiViet }}"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "TieuDe",
              "displayName": "TieuDe",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "NoiDungTomTat",
              "displayName": "NoiDungTomTat",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "HuongXuLy",
              "displayName": "HuongXuLy",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "MucDoAnhHuong",
              "displayName": "MucDoAnhHuong",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "LinkBaiViet",
              "displayName": "LinkBaiViet",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "NgayPhatHien",
              "displayName": "NgayPhatHien",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "PhatHieID",
              "displayName": "PhatHieID",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [340, 980],
      "id": "f1c947fe-c98e-4d8c-a7f1-4af7fc368def",
      "name": "Ghi k·∫øt qu·∫£ x·ª≠ l√Ω v√†o Sheets",
      "credentials": {
        "googleApi": {
          "id": "bDfKP49GQmA772n5",
          "name": "API Sheets"
        }
      }
    },
    {
      "parameters": {
        "fromEmail": "haulailaptrinh@gmail.com",
        "toEmail": "haulailaptrinh@gmail.com",
        "subject": "B√°o c√°o gi√°m s√°t h√†ng ng√†y - ƒêH C·ª≠u Long",
        "emailFormat": "html",
        "html": "=<!DOCTYPE html>\n<html>\n<head>\n  <meta charset=\"UTF-8\">\n  <style>\n    body {\n      font-family: Arial, sans-serif;\n      color: #333;\n      background-color: #f1f1f1;\n      padding: 20px;\n    }\n    .container {\n      background-color: #ffffff;\n      border-radius: 10px;\n      padding: 20px;\n      max-width: 700px;\n      margin: auto;\n      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);\n    }\n    h2 {\n      color: #b00020;\n      font-size: 20px;\n    }\n    .section {\n      margin-bottom: 16px;\n    }\n    .label {\n      font-weight: bold;\n      color: #555;\n    }\n    .value {\n      margin-top: 4px;\n      white-space: pre-line;\n    }\n    a {\n      color: #1a73e8;\n      text-decoration: none;\n    }\n    a:hover {\n      text-decoration: underline;\n    }\n  </style>\n</head>\n<body>\n  <div class=\"container\">\n    <h2>üì¢ {{ $json.tieuDe}}</h2>\n\n    <div class=\"section\">\n      <div class=\"label\">üìÖ Ng√†y ph√°t hi·ªán:</div>\n      <div class=\"value\">{{ $json.ngayPhatHien}}</div>\n    </div>\n\n    <div class=\"section\">\n      <div class=\"label\">üìå T√≥m t·∫Øt n·ªôi dung:</div>\n      <div class=\"value\">{{ $json.noiDung }}</div>\n    </div>\n\n    <div class=\"section\">\n      <div class=\"label\">üõ† H∆∞·ªõng x·ª≠ l√Ω:</div>\n      <div class=\"value\">{{ $json.huongXuLy }}</div>\n    </div>\n\n    {{ $json.mucDoAnhHuong ? `\n    <div class=\"section\">\n      <div class=\"label\">‚ö†Ô∏è M·ª©c ƒë·ªô ·∫£nh h∆∞·ªüng:</div>\n      <div class=\"value\">${$json.mucDoAnhHuong}</div>\n    </div>` : '' }}\n\n    <div class=\"section\">\n      <div class=\"label\">üåê Ngu·ªìn g·ªëc b√†i vi·∫øt:</div>\n      <div class=\"value\">{{ $('Ghi b√†i vi·∫øt v√†o Sheets').item.json.LinkBaiViet }}</div>\n    </div>\n\n    {{ $json.lienKet ? `\n    <div class=\"section\">\n      <div class=\"label\">üîó ƒê∆∞·ªùng d·∫´n:</div>\n      <div class=\"value\"><a href=\"${$json.lienKet}\" target=\"_blank\">${$json.lienKet}</a></div>\n    </div>` : '' }}\n  </div>\n</body>\n</html>\n",
        "options": {}
      },
      "type": "n8n-nodes-base.emailSend",
      "typeVersion": 2,
      "position": [340, 1140],
      "id": "c532d9b0-60f3-4c0f-85f7-238ba50f6738",
      "name": "G·ª≠i Email c·∫£nh b√°o h·∫±ng ng√†y",
      "webhookId": "0e4746a8-0953-4816-b515-ddde7f605e25",
      "credentials": {
        "smtp": {
          "id": "u9TNW1SRBYGnm2Wa",
          "name": "SMTP account 2"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "bd0c5c39-1b95-4ae9-823e-9dfb8bdd3239",
              "leftValue": "={{ $json.tieuDe }}",
              "rightValue": "",
              "operator": {
                "type": "string",
                "operation": "notEmpty",
                "singleValue": true
              }
            },
            {
              "id": "fef2c729-e2f1-48f2-a09c-6e14104bc3a9",
              "leftValue": "={{ $json.noiDung }}",
              "rightValue": "",
              "operator": {
                "type": "string",
                "operation": "notEmpty",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [20, 980],
      "id": "11380458-2ba1-420a-a10c-8179c49e89cc",
      "name": "Ki·ªÉm tra b√†i vi·∫øt r·ªóng"
    },
    {
      "parameters": {
        "jsCode": "// --- B∆∞·ªõc 1: T√°ch d·ªØ li·ªáu c≈© v√† m·ªõi ---\nconst sheetRows = [];\nconst newRows = [];\n\nfor (const item of items) {\n  const data = item.json;\n  if (data.row_number !== undefined) {\n    sheetRows.push(data); // D·ªØ li·ªáu ƒë√£ c√≥ tr√™n Google Sheet\n  } else {\n    newRows.push(data); // D·ªØ li·ªáu m·ªõi\n  }\n}\n\n// --- B∆∞·ªõc 2: T·∫°o danh s√°ch link ƒë√£ c√≥ ---\nconst existingLinks = new Set();\nfor (const row of sheetRows) {\n  if (typeof row.Link === 'string') {\n    existingLinks.add(row.Link.toLowerCase().trim());\n  }\n}\n\n// --- B∆∞·ªõc 3: L·ªçc b√†i m·ªõi ch∆∞a c√≥ link ---\nconst ketQua = [];\nfor (const row of newRows) {\n  const link = row.Link?.toLowerCase().trim();\n  if (link && !existingLinks.has(link)) {\n    ketQua.push({ json: row });\n  }\n}\n\n// --- B∆∞·ªõc 4: Tr·∫£ k·∫øt qu·∫£ cho n8n ---\nreturn ketQua;\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [20, 760],
      "name": "Ki·ªÉm tra b√†i vi·∫øt tr√πng",
      "id": "120e6d66-7e0b-4eb2-aebe-7492c6f6ab0c",
      "alwaysOutputData": true
    },
    {
      "parameters": {
        "rule": {
          "interval": [
            {
              "field": "hours",
              "hoursInterval": 12
            }
          ]
        }
      },
      "type": "n8n-nodes-base.scheduleTrigger",
      "typeVersion": 1,
      "position": [-820, 540],
      "name": "T·∫≠p l·ªãch ch·∫°y",
      "id": "f7cbc339-b82c-4b1d-945a-4d18632f48db"
    },
    {
      "parameters": {
        "rule": {
          "interval": [
            {
              "field": "weeks"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.scheduleTrigger",
      "typeVersion": 1,
      "position": [-820, 220],
      "name": "T·∫≠p l·ªãch ch·∫°y m·ªói tu·∫ßn",
      "id": "08b7dd45-22a1-47ae-83d6-d468166ce373"
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "documentId": {
          "__rl": true,
          "value": "1C8ttq-03f0qsvvZCY5TdXdkB5p2Y5a7PdGq1gGssBVU",
          "mode": "list",
          "cachedResultName": "Xu_Ly_Bai_Viet",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1C8ttq-03f0qsvvZCY5TdXdkB5p2Y5a7PdGq1gGssBVU/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": "gid=0",
          "mode": "list",
          "cachedResultName": "Sheet1",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1C8ttq-03f0qsvvZCY5TdXdkB5p2Y5a7PdGq1gGssBVU/edit#gid=0"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [-560, 180],
      "id": "256c5658-5601-4686-bffd-a89e33973a3a",
      "name": "ƒê·ªçc d·ªØ li·ªáu",
      "credentials": {
        "googleApi": {
          "id": "bDfKP49GQmA772n5",
          "name": "API Sheets"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// S·∫Øp x·∫øp b√†i vi·∫øt theo m·ª©c ƒë·ªô ∆∞u ti√™n: Cao > Trung > Th·∫•p\nconst uuTien = { \"Cao\": 3, \"Trung\": 2, \"Th·∫•p\": 1 };\n\n// H√†m chu·∫©n h√≥a m·ª©c ƒë·ªô ·∫£nh h∆∞·ªüng\nfunction chuanHoaMucDo(text) {\n  const muc = text?.split(\" \")[0] || \"\";\n  if (text?.startsWith(\"C·∫ßn x√°c minh th√™m\")) return \"Th·∫•p\";\n  return muc;\n}\n\n// L·∫•y to√†n b·ªô d·ªØ li·ªáu ƒë·∫ßu v√†o v√† x·ª≠ l√Ω\nconst ketQua = $input.all()\n  .sort((a, b) => {\n    const aMuc = chuanHoaMucDo(a.json[\"M·ª©c ƒë·ªô ·∫£nh h∆∞·ªüng\"]);\n    const bMuc = chuanHoaMucDo(b.json[\"M·ª©c ƒë·ªô ·∫£nh h∆∞·ªüng\"]);\n    return (uuTien[bMuc] || 0) - (uuTien[aMuc] || 0);\n  })\n  .map((item, index) => ({\n    json: {\n      STT: index + 1,\n      Ti√™u_ƒë·ªÅ: item.json[\"TieuDe\"] || \"Kh√¥ng r√µ\",\n      N·ªôi_dung: item.json[\"NoiDungTomTat\"] || \"Kh√¥ng r√µ\",\n      H∆∞·ªõng_x·ª≠_l√Ω: item.json[\"HuongXuLy\"] || \"Kh√¥ng r√µ\",\n      M·ª©c_ƒë·ªô: item.json[\"MucDoAnhHuong\"] || \"Kh√¥ng r√µ\",\n      Li√™n_k·∫øt: item.json[\"LienKet\"] || \"Kh√¥ng r√µ\",\n      Ng√†y_ph√°t_hi·ªán: item.json[\"NgayPhatHien\"] || \"Kh√¥ng r√µ\"\n    }\n  }));\n\nreturn ketQua;\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [-340, 200],
      "id": "95685b31-0103-408f-b808-f4412f4e621b",
      "name": "X·ª≠ l√Ω m·ª©c ƒë·ªô"
    },
    {
      "parameters": {
        "jsCode": "// ƒê·∫øm s·ªë b√†i vi·∫øt theo m·ª©c ƒë·ªô\nlet cao = 0, trung = 0, thap = 0;\n\nfor (const item of $input.all()) {\n  const muc = item.json[\"M·ª©c_ƒë·ªô\"]?.split(\" \")[0]; // L·∫•y ch·ªØ ƒë·∫ßu\n  if (muc === \"Cao\") cao++;\n  else if (muc === \"Trung\") trung++;\n  else if (muc === \"Th·∫•p\") thap++;\n}\n\nconst tong = cao + trung + thap;\n\n// L·∫•y ng√†y hi·ªán t·∫°i theo gi·ªù Vi·ªát Nam (UTC+7)\nconst now = new Date();\nnow.setUTCHours(now.getUTCHours() + 7);\n\n// T√≠nh ng√†y ƒë·∫ßu tu·∫ßn (th·ª© 2) v√† cu·ªëi tu·∫ßn (ch·ªß nh·∫≠t)\nconst dayOfWeek = now.getDay(); // Ch·ªß nh·∫≠t = 0\nconst monday = new Date(now);\nmonday.setDate(now.getDate() - (dayOfWeek === 0 ? 6 : dayOfWeek - 1));\nconst sunday = new Date(monday);\nsunday.setDate(monday.getDate() + 6);\n\n// ƒê·ªãnh d·∫°ng ng√†y YYYY-MM-DD\nconst formatDate = (d) => d.toISOString().split(\"T\")[0];\n\n// Tr·∫£ ra m·ªôt d√≤ng duy nh·∫•t k√®m ID (gi·∫£ s·ª≠ ID b·∫Øt ƒë·∫ßu t·ª´ 1)\nreturn [{\n  json: {\n    \"ID\": 1,\n    \"T·ª´ ng√†y\": formatDate(monday),\n    \"ƒê·∫øn ng√†y\": formatDate(sunday),\n    \"Cao\": cao,\n    \"Trung b√¨nh\": trung,\n    \"Th·∫•p\": thap,\n    \"T·ªïng\": tong\n  }\n}];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [-120, 200],
      "id": "d49afac7-88e0-46bc-b63b-010770f597bb",
      "name": "T·ªïng h·ª£p theo tu·∫ßn"
    },
    {
      "parameters": {
        "fromEmail": "haulailaptrinh@gmail.com",
        "toEmail": "haulailaptrinh@gmail.com",
        "subject": "B√°o c√°o gi√°m s√°t h√†ng ng√†y - ƒêH C·ª≠u Long",
        "emailFormat": "html",
        "html": "=<!DOCTYPE html>\n<html>\n<head>\n  <meta charset=\"UTF-8\">\n  <style>\n    table {\n      border-collapse: collapse;\n      width: 100%;\n      margin-top: 16px;\n    }\n    th, td {\n      border: 1px solid #ddd;\n      padding: 10px;\n      text-align: center;\n    }\n    th {\n      background-color: #f2f2f2;\n      font-weight: bold;\n    }\n    h2 {\n      color: #333;\n    }\n  </style>\n</head>\n<body>\n  <h2>B√°o c√°o n·ªôi dung ti√™u c·ª±c theo tu·∫ßn</h2>\n  <p>üìÖ Tu·∫ßn t·ª´ <strong>{{ $json[\"T·ª´ ng√†y\"] }}</strong> ƒë·∫øn <strong>{{ $json[\"ƒê·∫øn ng√†y\"] }}</strong></p>\n\n  <table>\n    <tr>\n      <th>M·ª©c ƒë·ªô</th>\n      <th>S·ªë l∆∞·ª£ng</th>\n    </tr>\n    <tr>\n      <td style=\"color: red;\"><strong>Cao</strong></td>\n      <td>{{ $json[\"Cao\"] }}</td>\n    </tr>\n    <tr>\n      <td style=\"color: orange;\"><strong>Trung b√¨nh</strong></td>\n      <td>{{ $json[\"Trung b√¨nh\"] }}</td>\n    </tr>\n    <tr>\n      <td style=\"color: green;\"><strong>Th·∫•p</strong></td>\n      <td>{{ $json[\"Th·∫•p\"] }}</td>\n    </tr>\n    <tr>\n      <th>T·ªïng</th>\n      <th>{{ $json[\"T·ªïng\"] }}</th>\n    </tr>\n  </table>\n\n  <p style=\"margin-top: 20px;\">Tr√¢n tr·ªçng,<br>H·ªá th·ªëng gi√°m s√°t n·ªôi dung</p>\n</body>\n</html>\n",
        "options": {}
      },
      "type": "n8n-nodes-base.emailSend",
      "typeVersion": 2,
      "position": [220, 340],
      "id": "ba53cb7e-4f4e-4590-af1a-3481178e9a50",
      "name": "G·ª≠i Email c·∫£nh b√°o h·∫±ng tu·∫ßn",
      "webhookId": "0e4746a8-0953-4816-b515-ddde7f605e25",
      "credentials": {
        "smtp": {
          "id": "u9TNW1SRBYGnm2Wa",
          "name": "SMTP account 2"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "return [\n  {\n    json: {\n      url: 'https://www.googleapis.com/customsearch/v1' +\n        '?key=AIzaSyA339ZLse5pPWgGMX0tDlJXsmu2TX1bt0w' +\n        '&cx=37a5edc77da3c4fc9' +\n        '&num=5' + // üîª ch·ªâ l·∫•y 5 k·∫øt qu·∫£\n        '&q=(' +\n          '\"ƒê·∫°i h·ªçc C·ª≠u Long\" OR \"ƒêH C·ª≠u Long\" OR \"Tr∆∞·ªùng C·ª≠u Long\" OR \"C·ª≠u Long University\"' +\n        ') ' +\n        '(' +\n          '\"l·ª´a ƒë·∫£o\" OR \"ph·ªët\" OR \"scam\" OR \"chi·∫øm ƒëo·∫°t\" OR \"b√™ b·ªëi\" OR \"thi·∫øu minh b·∫°ch\"' +\n        ') ' +\n        '(' +\n          '\"tuy·ªÉn sinh\" OR \"gi·∫£ng vi√™n\" OR \"gi√°o d·ª•c\" OR \"ƒë√†o t·∫°o\" OR \"sinh vi√™n\" OR \"b·∫±ng c·∫•p\"' +\n        ') ' +\n        // Lo·∫°i b·ªè c√°c k·∫øt qu·∫£ kh√¥ng li√™n quan ƒë·∫øn gi√°o d·ª•c\n        '-\"c√° c∆∞·ª£c\" -\"nh√† c√°i\" -\"soi k√®o\" -\"b√≥ng ƒë√°\" -\"casino\" -\"x·ªï s·ªë\" -\"l√¥ ƒë·ªÅ\" -\"ƒë√°nh b·∫°c\" -\"ti·ªÅn ·∫£o\" ' +\n        // Gi·ªõi h·∫°n ngu·ªìn b√°o uy t√≠n\n        'site:vnexpress.net OR site:tuoitre.vn OR site:thanhnien.vn OR site:zingnews.vn OR site:laodong.vn OR site:dantri.com.vn OR site:vietnamnet.vn' +\n        '&sort=date' + // s·∫Øp x·∫øp theo ng√†y\n        '&lr=lang_vi' + // ∆∞u ti√™n ti·∫øng Vi·ªát\n        '&gl=vn'\n    }\n  }\n];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [-400, 500],
      "id": "61ae9225-2c6d-460c-895d-4bce85c90c00",
      "name": "T·∫°o danh s√°ch URL"
    },
    {
      "parameters": {
        "jsCode": "// üëâ T·∫°o m·ªôt m·∫£ng tr·ªëng ƒë·ªÉ l∆∞u to√†n b·ªô k·∫øt qu·∫£ t·ª´ nhi·ªÅu ngu·ªìn kh√°c nhau\nconst allItems = [];\n\nfor (const input of items) {\n  // üëâ L·∫•y danh s√°ch k·∫øt qu·∫£ t√¨m ki·∫øm t·ª´ Custom Search API (n·∫øu c√≥)\n  const results = input.json.items || [];\n  \n\n  // üëâ Duy·ªát qua t·ª´ng k·∫øt qu·∫£ trong `items`\n  for (const item of results) {\n    // üëâ ƒê·∫©y m·ªói k·∫øt qu·∫£ v√†o m·∫£ng `allItems` d∆∞·ªõi d·∫°ng m·ªôt object chu·∫©n\n    allItems.push({\n      json: {\n        title: item.title || '',       \n        link: item.link || '',         \n        snippet: item.snippet || '',               \n      }\n    });\n  }\n}\n\n// üëâ Tr·∫£ v·ªÅ to√†n b·ªô k·∫øt qu·∫£ ƒë√£ h·ª£p nh·∫•t t·ª´ nhi·ªÅu ngu·ªìn\nreturn allItems;\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [300, 540],
      "id": "2fc892cd-bec8-4f1f-a941-0d3c10a6921e",
      "name": "T√°ch danh s√°ch b√†i vi·∫øt",
      "alwaysOutputData": true
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "append",
        "documentId": {
          "__rl": true,
          "value": "1DFXnI8dJJH4X1Hy9aOlVsq5KAMI62Qfow0XmG5FWtxk",
          "mode": "list",
          "cachedResultName": "ThongKeBaoCaoTuan",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1DFXnI8dJJH4X1Hy9aOlVsq5KAMI62Qfow0XmG5FWtxk/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": "gid=0",
          "mode": "list",
          "cachedResultName": "Sheet1",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1DFXnI8dJJH4X1Hy9aOlVsq5KAMI62Qfow0XmG5FWtxk/edit#gid=0"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "BaoCaoID": "={{ $json.ID }}",
            "TuNgay": "={{ $json['T·ª´ ng√†y'] }}",
            "DenNgay": "={{ $json['ƒê·∫øn ng√†y'] }}",
            "SoLuongCao": "={{ $json.Cao }}",
            "SoLuongTrungBinh": "={{ $json['Trung b√¨nh'] }}",
            "SoLuongThap": "={{ $json['Th·∫•p'] }}",
            "TongSoLuong": "={{ $json['T·ªïng'] }}"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "TuNgay",
              "displayName": "TuNgay",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "DenNgay",
              "displayName": "DenNgay",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "SoLuongCao",
              "displayName": "SoLuongCao",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "SoLuongTrungBinh",
              "displayName": "SoLuongTrungBinh",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "SoLuongThap",
              "displayName": "SoLuongThap",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "TongSoLuong",
              "displayName": "TongSoLuong",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "BaoCaoID",
              "displayName": "BaoCaoID",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [200, 140],
      "id": "02302db7-8c05-4fe0-aec6-5327e653ae2e",
      "name": "Ghi k·∫øt qu·∫£ b√°o c√°o tu·∫ßn",
      "credentials": {
        "googleApi": {
          "id": "bDfKP49GQmA772n5",
          "name": "API Sheets"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "documentId": {
          "__rl": true,
          "value": "1bVSPnFZ-0XW9VZ74TzBVHJxMn0sT61lYolF2XKzAyTU",
          "mode": "list",
          "cachedResultName": "BaiViet",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1bVSPnFZ-0XW9VZ74TzBVHJxMn0sT61lYolF2XKzAyTU/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": "gid=0",
          "mode": "list",
          "cachedResultName": "Sheet1",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1bVSPnFZ-0XW9VZ74TzBVHJxMn0sT61lYolF2XKzAyTU/edit#gid=0"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4,
      "position": [-520, 800],
      "name": "ƒê·ªçc file sheets BaiViet",
      "id": "282d8a48-ee0c-48a9-8948-df7fbb4de044",
      "credentials": {
        "googleApi": {
          "id": "bDfKP49GQmA772n5",
          "name": "API Sheets"
        }
      }
    }
  ],
  "pinData": {},
  "connections": {
    "Google Gemini Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "G·ª≠i b√†i cho AI ph√¢n t√≠ch ti√™u c·ª±c",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "G·ª≠i request t√¨m b√†i vi·∫øt": {
      "main": [
        [
          {
            "node": "T√°ch danh s√°ch b√†i vi·∫øt",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "L·ªçc b√†i vi·∫øt ti√™u c·ª±c": {
      "main": [
        [
          {
            "node": "G·ªôp b√†i vi·∫øt m·ªõi v·ªõi d·ªØ li·ªáu c≈©",
            "type": "main",
            "index": 0
          },
          {
            "node": "ƒê·ªçc file sheets BaiViet",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "G·ªôp b√†i vi·∫øt m·ªõi v·ªõi d·ªØ li·ªáu c≈©": {
      "main": [
        [
          {
            "node": "Ki·ªÉm tra b√†i vi·∫øt tr√πng",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Ghi b√†i vi·∫øt v√†o Sheets": {
      "main": [
        [
          {
            "node": "G·ª≠i b√†i cho AI ph√¢n t√≠ch ti√™u c·ª±c",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "G·ª≠i b√†i cho AI ph√¢n t√≠ch ti√™u c·ª±c": {
      "main": [
        [
          {
            "node": "X·ª≠ l√Ω k·∫øt qu·∫£ t·ª´ AI",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "X·ª≠ l√Ω k·∫øt qu·∫£ t·ª´ AI": {
      "main": [
        [
          {
            "node": "Ki·ªÉm tra b√†i vi·∫øt r·ªóng",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Ki·ªÉm tra b√†i vi·∫øt r·ªóng": {
      "main": [
        [
          {
            "node": "Ghi k·∫øt qu·∫£ x·ª≠ l√Ω v√†o Sheets",
            "type": "main",
            "index": 0
          },
          {
            "node": "G·ª≠i Email c·∫£nh b√°o h·∫±ng ng√†y",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Ki·ªÉm tra b√†i vi·∫øt tr√πng": {
      "main": [
        [
          {
            "node": "Ghi b√†i vi·∫øt v√†o Sheets",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "T·∫≠p l·ªãch ch·∫°y": {
      "main": [
        [
          {
            "node": "T·∫°o danh s√°ch URL",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "T·∫≠p l·ªãch ch·∫°y m·ªói tu·∫ßn": {
      "main": [
        [
          {
            "node": "ƒê·ªçc d·ªØ li·ªáu",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ƒê·ªçc d·ªØ li·ªáu": {
      "main": [
        [
          {
            "node": "X·ª≠ l√Ω m·ª©c ƒë·ªô",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "X·ª≠ l√Ω m·ª©c ƒë·ªô": {
      "main": [
        [
          {
            "node": "T·ªïng h·ª£p theo tu·∫ßn",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "T·ªïng h·ª£p theo tu·∫ßn": {
      "main": [
        [
          {
            "node": "G·ª≠i Email c·∫£nh b√°o h·∫±ng tu·∫ßn",
            "type": "main",
            "index": 0
          },
          {
            "node": "Ghi k·∫øt qu·∫£ b√°o c√°o tu·∫ßn",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "T·∫°o danh s√°ch URL": {
      "main": [
        [
          {
            "node": "G·ª≠i request t√¨m b√†i vi·∫øt",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "T√°ch danh s√°ch b√†i vi·∫øt": {
      "main": [
        [
          {
            "node": "L·ªçc b√†i vi·∫øt ti√™u c·ª±c",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ƒê·ªçc file sheets BaiViet": {
      "main": [
        [
          {
            "node": "G·ªôp b√†i vi·∫øt m·ªõi v·ªõi d·ªØ li·ªáu c≈©",
            "type": "main",
            "index": 1
          }
        ]
      ]
    }
  },
  "active": false,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "f5c3e436-bc59-426b-ace4-fdbb93568a8e",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "dc11cb4891443fae026bd649ce2af9b7a75f9d81700ccc3935ac1d32053faa0e"
  },
  "id": "ADrnZcD3GkAquBvz",
  "tags": []
}
